# Terraform + Ansible Docker Deployment

Automated infrastructure provisioning and Docker deployment on AWS EC2 using Terraform and Ansible.

## Overview

- **Terraform**: Creates AWS infrastructure (VPC, EC2, security groups)
- **Ansible**: Installs Docker and deploys containerized applications
- **Automated**: Single command deployment from infrastructure to running containers

## Prerequisites

- AWS account with credentials configured
- Terraform installed
- Ansible installed
- SSH key pair
- Docker Hub account (for private images)

## Setup

1. **Copy sample configuration files:**

```bash
cd terraform
cp terraform.tfvars.sample terraform.tfvars
# Edit terraform.tfvars with your values

cd ../ansible
cp vars.sample vars
# Edit vars with your Docker credentials

cp ansible.cfg.sample ansible.cfg
# Optional: Customize Ansible settings
```

2. **Configure Terraform variables** (`terraform/terraform.tfvars`):
   - `vpc_cidr_block`: VPC CIDR block
   - `subnet_cidr_block`: Subnet CIDR block
   - `availability_zone`: AWS availability zone
   - `my_ip`: Your IP address for SSH access
   - `public_key_path`: Path to your SSH public key
   - `private_key_path`: Path to your SSH private key

3. **Configure Ansible variables** (`ansible/vars`):
   - `docker_username`: Docker Hub username
   - `docker_password`: Docker Hub password/PAT
   - `docker_registry_url`: Docker registry URL

## Quick Start

Run deployment:

```bash
cd terraform
terraform init
terraform apply -auto-approve
```

The provisioner automatically:
- Updates Ansible hosts file with EC2 IP
- Runs Ansible playbook to install Docker
- Deploys containers from docker-compose

## Structure

```
.
├── terraform/                # Infrastructure as Code
│   ├── main.tf
│   ├── terraform.tfvars.sample
│   └── terraform.tfvars     # (git-ignored)
├── ansible/                 # Configuration Management
│   ├── deploy-docker.yaml
│   ├── ansible.cfg.sample
│   ├── vars.sample
│   ├── hosts.sample
│   ├── ansible.cfg          # (git-ignored)
│   ├── vars                 # (git-ignored)
│   └── hosts                # (auto-generated)
├── docker-compose.yml       # Container definitions
├── monitor.html            # Monitoring page
└── README.md
```

## Services Deployed

- **Web App**: Your custom application on port 80
- **Redis**: Cache service
- **Monitor**: Status page on port 8080

## Manual Ansible Run

If needed, run Ansible separately:

```bash
cd ansible
ansible-playbook deploy-docker.yaml
```

## Cleanup

```bash
cd terraform
terraform destroy -auto-approve
```

## Notes

- Sensitive files (`vars`, `*.tfvars`, `hosts`) are git-ignored
- Use the `.sample` files as templates
- The hosts file is automatically generated by Terraform

